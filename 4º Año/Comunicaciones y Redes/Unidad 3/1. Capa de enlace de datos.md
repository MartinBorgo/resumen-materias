- Nivel 2 del modelo OSI
- Unidad de datos: TRAMA
- Función: Realizar una comunicación eficiente entre dos maquinas adyacentes
- Conceptos relacionados:
	- Errores de comunicación
	- Velocidad de transmisión
	- Retardo de propagación distinto de cero

### Protocolos

- Función:  Mover una trama entre nodos, sobre un enlace individual
	- Proporciona servicios a la capa de red
	- Cada trama de la capa de enlace encapsula un datagrama de la capa de red. 
		- Datagrama: paquete de datos que constituye el mínimo bloque de información en una red de conmutación por datagramas. Fuente: Wikipedia
- Debe definir el formato de los PDU intercambiados
- Ej.: Ethernet, LAN 802.11 (Wireless), Token ring, HDLC (WAN)
#### Protocolos orientados a carácter

Son aquellos protocolos en los que los mensajes se componen de un conjunto de caracteres de un determinado código. Cada carácter (de información y control) tiene un significado especifico y no ambiguo. 
Fueron los primeros protocolos usados y siguen en vigor, aunque actualmente prevalecen los orientados al bit.
Emplean un determinado código para la transmisión de la información, usando ciertos caracteres para establecer control en la comunicación. El envió de tramas va acompañado de determinados caracteres de control.  
Códigos mas utilizados: ASCII y EBCDIC.

#### Protocolos orientados al bit

Mas modernos que los orientados al carácter. Superan las dificultades que se le presentan a estos últimos en determinados casos.

Ventajas: 
- Independencia del código utilizado: Tratar de transmitir un conjunto de bits que pueden   configurar información en cualquier código.
- Gran eficiencia en la transmisión: La relación entre los bits de información y control es alta.
- Gran fiabilidad en las transmisiones: Se dispone de métodos de control para la detección y recuperar errores con eficacia.

Protocolos mas extendidos:
- HDLC (High-level Data Link Control) de la ISO
- ADCCP (Advanced Data Communication Control Procedures) de ANSI
- LAPB (Link Access Procedure Balanced) del CCITT
- SDLC (Synchronous Data Link Control) de IBM

### Estructura de la trama HDLC

![[Trama_HDLC.png]]

F - Indicador (Flag): sirve como separador de tramas, sincronizador, relleno entre tramas.
A - direccion (Address): designa la estación receptora en comandos y emisora en respuestas. Puede identificar hasta 256 terminales, aun mas si se amplia este campo.
C - Control: Determina el tipo de trama y contiene los números de secuencia.
I - Información: contiene datos de capas superiores del modelo OSI, solo esta presente en 2 tipos de tramas (I, FRMR).
FCS - Secuencia de Verificación de Trama (Frame Control Sequence): se usa para control de errores, conteniendo el resto de la división del contenido de la trama por un polinomio generador (CRC-CCITT)

### Características destacadas

- Canal activo: La red o el ETD esta transmitiendo una trama, una secuencia de anulación de trama o indicadores sucesivos.
- Canal Inactivo: Se detecta la transmisión de 15 o mas "1" consecutivos,
- Trama invalida: No esta comprendida entre 2 indicadores o hay menos de 32 bits entre estos.
- Anulación de trama: Hay entre 7 y 14 bits seguidos (sin ceros)

### Comandos y respuestas del protocolo HDLC 

Los comandos se envían por un extremo, exigiendo o no una respuesta del otro extremo.

Tipos básicos de trama: 
- Información
- Supervisión
- Sin numerar

El campo de **Control** de la trama indica su tipo y en algunos casos contiene información para el manejo de protocolos.

### Campo de control en tramas de información

usadas para transmitir mensajes de nivel superior que serán fraccionados y numerados para su reconstrucción en el destino.

![[Campo_de_control_en_tramas_de_información.png]]

N(S): Numero de secuencia enviada
P/F: Poll / Trama final
N(R): Numero de secuencia a recibir

### Campo de control en tramas de supervisión

Estas tramas sirven para funciones de control de flujos, petición de estados, etc.
Funciones: 
- Receptor preparado (Receive Ready-RR):  Indica que la estación receptora esta preparado para recibir tramas, o que esta solicitando el estado de la estación emisora, o esta pidiendo la validación de una trama ya transmitida.
- Receptor no preparado (Receive Not Ready-RNR): Indica que la estación receptora no esta disponible para recibir tramas.
- Rechazo (Reject-REJ): Invalida la trama que es indicada por su numero de secuencia, pidiendo que se la retransmita y a las posteriores (si hay).
- Rechazo selectivo (Selective Reject-SREJ): invalida la trama que es indicada por su numero de secuencia, pidiendo que se la retransmita.

![[Campo_de_control_en_tramas_de_supervisión.png]]

P/F: Poll / Trama final
N(R): Numero de secuencia a recibir

### Campo de control en tramas no numeradas

Estas tramas se usan para establecer y liberar enlaces y otras funciones de control.

Comandos de selección del modo de operación:
- SNRM (Set Normal Response Mode)
- SARM (Set Asynchronous Response Mode)
- SABM (Set Asynchronous Balanced Mode)

Comandos de desconexión (Disconnect-DISC): Indica la terminación y posterior desconexión.

Respuesta de reconocimiento no numerado (Unnumbered Acknowledge-UA): Indica que se recibió y ejecuto un comando de selección de modo de operación (transmisión) o de desconexión.

Respuesta de no aceptación de modo de transmisión (Disconnected Mode-DM): Indica que no se pudo entrar en el modo de transmisión solicitado o solicita una orden de selección de modo.

Respuesta de rechazo de trama (Frame Reject-FRMR): indica que se rechazo la trama transmitida.

![[Campo_de_control_en_tramas_no_numeradas.png]]

P/F: Poll / Trama final

### Algunos ejemplos de funcionamiento del protocolo HDLC

![[Ejemplos_HDLC.png]]

### Servicios de capa de enlace

**Sin conexión y sin asentimiento:** 
- La emisora transmite tramas independientes hacia la receptora, esta ultima no envía una señal de confirmación.
- En caso de que la trama se pierda su recuperación se da en capas superiores.
- Servicio ideal cuando hay baja tasa de error y para trafico en tiempo real (voz).

**Sin conexión y con asentimiento:**
- Cada trama transmitida es confirmada individualmente. (ACK)
- Se sabe si la trama llego bien.
- Si no hay confirmación después de cierto tiempo se puede volver a transmitir.

**Orientado a conexión:**
- La maquina transmisora y receptora establecen una conexión antes de transmitir.
- Cada trama transmitida es numerada. 
- La capa de enlace se asegura que cada trama se reciba solo una vez y en el orden correcto.
- En esta modalidad las transmisiones tienen tres partes:
	- La conexión es establecida cuando ambas partes han iniciado las variables y contadores.
	- una o mas tramas se transmiten.
	- La conexión se libera.

**Delimitación de tramas:**
- La capa de enlace divide el flujo de bits en tramas y calcula un código de redundancia para cada una.
- Existen diferentes métodos para dividir el flujo de bits:
	- Cuenta de caracteres. 
	- Caracteres de inicio y fin, con inserción de caracteres. 
	- Banderas de inicio y final, con inserción de bit. 
	- Violaciones de código en la capa física

### Métodos de delimitación de tramas:

**Cuenta de caracteres:**
Se utiliza un campo en la cabecera para especificar el número de caracteres en la trama.

![[Cuenta_de_caracteres.png]]

Problema: Si el carácter de cuenta se distorsiona por el ruido, el receptor se desincronizada y no podrá encontrar el inicio de la siguiente trama.

**Inserción de caracteres:**
- Cada trama comienza y termina con la secuencia de caracteres ASCII: DLE STX --------- DLE ETX
- Al momento de sincronizar el receptor solo debe buscar estos caracteres.
- Ej.: DLE STX A DLE B DLE ETX ; DLE STX A DLE B DLE ETX .

Desventaja: gran asociación con código de caracteres (ASCII).

**Inserción de bits:**
- Cada trama comienza y termina con un patrón de bits llamado bandera o flag (01111110).
- La transparencia para no confundir datos de información con datos de control se da cuando:
	- Si el emisor encuentra cinco bits 1 seguidos, inserta un 0.
	- Si el receptor encuentra cinco bits 1 seguidos por un 0, como entrada, entonces elimina el 0.
- Ej.: 
	- Trama original: 0 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 0
	- Trama después del emisor: 0 1 1 0 1 1 1 1 1 **0** 1 1 1 1 1 **0** 1 1 1 1 1 **0** 1 0 0 1 0
	- Trama después del receptor: 0 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1

**Violación de código en la capa física:**

Usada en la capa física con codificación Manchester. Se Utiliza las combinaciones de alto-bajo y bajo-alto para encapsular la trama. 

### Detección y corrección de errores: 

#### Código:

- Códigos de corrección de errores: En cada bloque de datos transmitido se incluye información redundante para que el receptor pueda deducir que carácter debió ser enviado. 
- Códigos de detección de errores: Se incluye solo la redundancia necesaria para que el receptor sepa que hubo un error, sin saber de que tipo, y pida la retransmisión. 

#### Protección contra los errores

- Detección: 
	- Eco 
	- Control de paridad por bloque (VRC) 
	- Control de paridad por carácter (LRC) 
	- División por polinomio generador (CRC, FCS)

- Corrección: 
	- Retransmisión 
	- Corrección automática (por ej. FEC Forward Error Correction)

### Códigos para detección de errores

- VRC (Vertical Redundancy Check):  El emisor agrega a cada carácter un bit el cual al ser sumado en conjunto con toda la secuencia da un valor par o impar, anteriormente definido. El receptor repite la operación y compara con el bit recibido, si son iguales se da por correcto el carácter.
- LRC (Longitudinal Redundancy Check): Adición al VRC, agrega al final de un bloque de caracteres una secuencia de bits individuales cuya suma lógica de todos los bits de la misma posición da par o impar. El receptor repite la operación y compara con la secuencia recibida, dando por correcto el carácter si son iguales. Permite detectar dos bits erróneos producidos en el mismo carácter.
- CRC (Cyclic Redundancy Check):
	- También llamado Código Polinómico o Código de Redundancia Cíclica ( CRC).
	- Método mas difundido de detección de errores.
	- Se basa en tratar las cadenas de bits como representaciones de polinomios con coeficientes de 0 y 1.
	- Implementado en hardware.
	- Una trama de k bits se considera como la lista de coeficientes de un polinomio que van de X^K-1 a X^0
	- Cuando se emplea este código, el transmisor y el receptor acuerdan un polinomio generador, G (x) por adelantado.
	- Se calcula la suma de comprobación para una trama y se anexa al final de la trama, de tal manera que la suma + la trama sea divisible por G (x).
	- Cuando el receptor recibe esta trama con la suma de comprobación, la divide entre G(x). Si hay resto, entonces ha habido un error de transmisión.
	- Ej.:
		- Trama : 1010001101 
		- Generador: 110101 ( x5+x4+x2+1)
		- Trama mas ceros según grado de G(x): 1010001101 00000

### Protocolos de control de flujo
#### Control de flujo de la transmisión
- Consiste en regular la velocidad de transmisión de datos para no saturar al emisor.
- Los protocolos de capa 2 (capa de enlace datos) tienen reglas para saber cuando es posible enviar una trama.
- Generalmente, el receptor autoriza expresa o implícitamente la transmisión.
- Consideraciones a tener en cuenta: 
	- Tiempo de procesamiento (Capas de red). 
	- Disponibilidad de buffers (Espacio) .
	- Perfomance del canal de comunicación.
#### Protocolos de ventana corrediza
- Cada trama de salida tiene un numero de secuencia con un intervalo desde 0 hasta un máximo.
- En cualquier instante, el transmisor mantiene un grupo de números de secuencia que corresponde a las tramas que tiene permitido enviar. ( Ventana transmisora)
- El receptor mantiene una ventana receptora, correspondiente al grupo de tramas que puede recibir.
- Las ventanas del emisor y receptor no tienen por que ser del mismo tamaño.
- Hay ventanas fijas y otras que crecen y disminuyen a medida que se envían y se reciben las tramas.
- Necesidad de transmitir datos en ambas direcciones (transmisión full duplex) y con varias tramas en el enlace.
- Emisor y receptor usan el mismo canal para enviar tramas y ACK (acuses)
- Mejora = Piggybacking 
	- El receptor espera la próxima trama de salida e incorpora el ACK.
- Ventaja: mejor aprovechamiento del ancho de banda del canal.
- Ej.: ![[Ejemplo_ventanas.png]]
##### Ventana transmisora
- Los números de secuencia en la ventana transmisora indican las tramas no reconocidas (sin ACK´s)
- Cuando llega un paquete nuevo de la capa de red, se le da el numero de secuencia mayor y la orilla superior de la ventana avanza en uno.
- Cuando se recibe un ACK la orilla inferior avanza en uno.
- La ventana mantiene siempre los números de secuencia de las tramas no reconocidas.
##### Ventana receptora
- El tamaño de la ventana receptora corresponde a la cantidad de tramas que puede aceptar.
- Si una trama cae fuera de la ventana, se descarta.
- Cuando se recibe una trama con el numero de secuencia igual al extremo inferior de la ventana, se pasa a la capa de red, se genera el acuse y se avanza la ventana en uno.

### Mecanismos de solicitud de repetición automática

- ARQ (Automatic Repeat Request) 
- Variantes normalizadas: 
	- ARQ con parada y espera 
	- ARQ con adelante-atrás N 
	- ARQ con rechazo selectivo  
- Procedimientos basados en la técnica de control de flujo y para efectuar confirmaciones o retransmisiones de tramas perdidas o dañadas.

#### ARQ con parada y espera (PROTOCOLO SIMPLEX)

- Cuando los datos se transmiten solo en una dirección se tienen protocolos sencillos, como:
	- Parada y espera: el transmisor envía una trama y espera un acuse (ACK) antes de continuar.
	- Desventaja: uso ineficiente del medio en enlaces de grandes distancias y razón de datos elevada.

#### Protocolos con control de errores

- ARQ adelante –atrás –N :
	- Una estación envía una serie de tramas numeradas secuencialmente.
	- Si no hay errores, el destino confirma las tramas en forma normal.
	- Al detectarse un error en una trama, el destino envía una respuesta negativa.
	- Hasta que no se reciba correctamente la trama errónea, se descarta esa y las posteriores.
	- Entonces, el transmisor debe reenviar la trama con error mas todas las posteriores.

- ARQ con rechazo selectivo – repetición selectiva:
	- Las tramas que se retransmiten son las que tienen error.
		- Es decir las que son rechazadas (indicando nº secuencia) o por fin de temporizador.