## Redes de Área Local Inalámbricas (WLAN)

Al igual que para Ethernet, existen un apartado de la IEEE 802 que especifica todo lo relacionado con redes de área local inalámbricas. A través de este estándar podemos distinguir cuatro áreas de aplicación para este tipo de redes LAN:

1. **Ampliación de redes LAN**. Las LAN inalámbricas son cruciales en entornos con grandes superficies o edificios históricos, donde el cableado tradicional no es viable o permitido. Estas redes inalámbricas suelen coexistir con redes cableadas. Además, existen configuraciones de LAN inalámbricas, como la de celda única y de múltiples celdas, donde uno o varios módulos de control gestionan la conectividad y el acceso de los dispositivos finales.
2. **Interconexión de edificios**. Otra aplicación muy común de las redes inalámbricas es para conectar dos edificios vecinos a través de un enlace punto a punto.
3. **Acceso nómada**. En entorno amplio, como un campus o un centro financiero situado lejos de un grupo de edificios. Los usuarios se pueden desplazar con sus computadores portátiles y pueden desear conectarse con los servidores de una LAN inalámbrica desde distintos lugares.
4. **Redes ad-hoc**. Una red ad hoc es una red entre iguales, sin servidor central, establecida temporalmente para satisfacer alguna necesidad inmediata. Este tipo de redes inalámbricas no tienen una infraestructura como tal, los participantes de esta red utilizan sus propios recursos a la hora de establecer una conexión.

Las redes LAN inalámbricas se clasifican, generalmente, de acuerdo con la técnica de transmisión que utilizan. Todas las LAN inalámbricas actuales se encuentran dentro de una de las siguientes categorías:

- **LAN de infrarrojos (IR)**: Una celda individual en una LAN IR está limitada a una sola habitación, dado que la luz infrarroja no es capaz de atravesar muros opacos.
- **LAN de espectro expandido**: Hace uso de tecnologías de transmisión de espectro expandido. En la mayoría de los casos, estas LAN funcionan en las bandas ISM, de modo que no se necesita licencia FCC.
- **Microondas de banda estrecha**: estas LAN operan en el rango de las microondas, pero no hacen uso de espectro expandido. Algunos de estos productos funcionan a frecuencias para las que es necesaria una licencia FCC, mientras que otras lo hacen en alguna de las bandas ISM.

Si bien los infrarrojos permiten alcanzar velocidades de transmisión mucho más altas, la instalación es mucho más barata y pueden brindar cobertura a toda una habitación sin problemas alguno. No obstante estas ondas no pueden atravesar muros sólidos, sin mencionar que son muy susceptibles a los ruidos provocados por la luz natural y artificial, si bien esto se puede solucionar aumentando el rango de frecuencias a las que opera el infrarrojo estas deben ser limitadas de todas maneras debido a que puede dañar la vista y aumentar el consumo eléctrico del edificio. Por estas razones se utilizan mucho más los demás tecnologías de transmisión.
Actualmente, las redes LAN inalámbricas más populares son aquellas que utilizan técnicas de espectro expandido. Este tipo de redes generalmente adoptan una disposición de celdas múltiples donde celdas adyacentes usan diferentes frecuencias para evitar interferencias, pudiendo adoptar una topología basada en concentradores, situados en lugares como el techo y conectados a LAN cableadas, o optar por una configuración entre iguales usando algoritmos MAC como CSMA para controlar el acceso. Los concentradores facilitan la conectividad entre redes y pueden controlar la transición de estaciones móviles entre celdas. Además, es deseable que estas redes operen sin necesidad de licencia.
El término microondas de banda estrecha describe la utilización de una banda de frecuencias específica y limitada para la transmisión de voz, datos y vídeo, que hasta hace poco requería licencia. Motorola, con 600 licencias en EE.UU., controla la frecuencia de 18 GHz para asegurar comunicaciones sin interferencias entre redes LAN en áreas metropolitanas. Estas frecuencias son gestionadas por la FCC y están diseñadas para evitar interferencias entre sistemas geográficamente cercanos, utilizando configuraciones de celdas con bandas no solapadas. A diferencia de las bandas ISM no reguladas, las bandas con licencia ofrecen seguridad legal contra las interferencias.

### Arquitectura y Servicios IEEE 802.11

En 1990 se formó el comité IEEE 802.11 con el propósito de desarrollar un protocolo MAC y una especificación del medio físico para redes LAN inalámbricas. El componente elemental de una red LAN inalámbrica es un ***conjunto básico de servicios (BSS)***, consistente en un número de estaciones ejecutando el mismo protocolo MAC y compitiendo por el acceso al mismo medio inalámbrico compartido. Pudiendo funcionar de forma aislada o estar conectados a un ***sistema troncal distribuido (DS)*** a través de un ***punto de acceso (AP)*** que funciona como puente. El protocolo MAC puede ser completamente distribuido o estar centralizado siendo controlado todo desde el punto de acceso.
Un ***conjunto extendido de servicios (ESS)*** consiste en dos o más conjuntos básicos de servicios interconectados mediante un sistema de distribución. Este conjunto extendido de servicios aparece a nivel de control de enlace lógico como una única red LAN lógica.

![[conjunto-extendido-servicios.png]]

Por otro lado, la normativa IEEE 802.11 define nueve servicios que deben ser proporcionados por una red inalámbrica para ofrecer una funcionalidad equivalente a la inherente a una LAN cableada tradicional, entre las cuales se encuentran los siguientes servicios:

1. **Distribución**: Es el servicio primario utilizado por las estaciones para intercambiar tramas MAC cuando la trama debe atravesar el DS para pasar de una estación en un BSS a otra estación en un BSS diferente.
2. **Integración**: Permite la transferencia de datos entre una estación situada en una LAN IEEE 802.11 y otra estación en una LAN IEEE 802.x.

>[!tldr] Capa MAC y Transición
>El objetivo principal de la capa MAC es la transferencia de MSDU (MAC Service Data Unit) entre entidades MAC, tarea realizada por el servicio de distribución que requiere información de las estaciones dentro del ESS, proporcionada por los servicios de asociación. Antes de entregar o aceptar datos de una estación, esta debe estar asociada, lo que lleva al concepto de movilidad. Hay tres tipos de transiciones:
>
>1. **Sin transición:** La estación es estacionaria o se mueve solo dentro del rango de un único BSS.
>2. **Transición BSS:** La estación se mueve de un BSS a otro dentro del mismo ESS, requiriendo que la función de direccionamiento reconozca su nueva ubicación.
>3. **Transición ESS:** La estación se mueve entre BSS de diferentes ESS, donde la continuidad de las conexiones de capas altas no está garantizada y puede haber interrupciones.
> 
>Para la entrega de mensajes, el servicio de distribución necesita conocer la ubicación exacta de la estación destino y la identidad del punto de acceso al que debe entregarse el mensaje. Esto implica mantener una asociación con el punto de acceso del BSS actual. Hay tres servicios clave para gestionar estas asociaciones, los cuales son la asociación, la reasociación y la disociación.

3. **Asociación:** Establece una relación inicial entre una estación y un punto de acceso, permitiendo que la estación transmita o reciba tramas.
4. **Reasociación:** Permite transferir una asociación existente a otro punto de acceso, facilitando el movimiento del terminal de un BSS a otro.
5. **Disociación:** Señala el fin de una asociación, esta señal puede ser emitida por la estación o el punto de acceso. Una estación debería proporcionar este aviso antes de abandonar un ESS o apagarse. No obstante, las funciones de gestión MAC incluyen mecanismos para protegerse frente a estaciones que desaparezcan sin emitir esta notificación.
6. **Autenticación:** Utilizado por las estaciones para establecer y comunicar su identidad antes de asociarse con un punto de acceso. En entornos inalámbricos, la autenticación es crucial debido a la accesibilidad abierta de la red. El estándar admite múltiples esquemas de autenticación, desde básicos hasta avanzados con cifrado de llave pública, pero requiere que la autenticación sea mutuamente aceptada antes de establecer una conexión con un punto de acceso.
7. **Fin de la autenticación:** Este servicio se utiliza para finalizar una sesión de autenticación existente, asegurando que las conexiones sean terminadas adecuadamente.
8. **Privacidad:** Asegura que los contenidos de los mensajes sean accesibles únicamente para el receptor legítimo. El estándar permite el uso opcional de cifrado para proteger la información transmitida, evitando la lectura por partes no autorizadas.
9. **Entrega de MSDU**: Una MSDU es un bloque de datos que el usuario MAC le pasa a la capa MAC, generalmente en la forma de una PDU LLC. Si una MSDU es demasiado grande para ser transmitida en una sola trama MAC, puede ser fragmentada y transmitida en una serie de tramas.

### Control de Acceso al Medio

La capa MAC de IEEE 802.11 cubre tres aspectos funcionales la entrega fiable de datos, el control de acceso y la seguridad. A continuación describiremos más a detalle cada uno de estos aspectos.

#### Entrega Fiable de Datos

El ruido, las interferencias y otros efectos de propagación repercuten en la pérdida de un número significativo de tramas. Incluso disponiendo de códigos correctores de errores, es posible que muchas tramas MAC no sean recibidas apropiadamente. Si bien este problema puede ser solucionado delegando el problema de la corrección de errores a capas superiores esto no es lo más eficiente, es por eso que el estándar incluye un protocolo de intercambio de tramas. Cuando una estación recibe una trama de datos, envía una trama de confirmación de vuelta a la estación de origen. Este intercambio es indivisible y no debe ser interrumpido por otras transmisiones. Si la estación de origen no recibe la confirmación rápidamente, posiblemente debido a daños en la trama de datos o de control, retransmitirá la trama.
Para aumentar la fiabilidad, se puede emplear un esquema de cuatro tramas. Primero, el emisor envía una ***trama de solicitud para enviar (RTS)*** al destino, el receptor responde con una ***trama de permiso para enviar (CTS)***. Después de recibir esta trama, el emisor envía la trama de datos y el destino responde con una confirmación. La trama RTS sirve para notificar a las estaciones cercanas que una transmisión está en curso, evitando interferencias.

#### Control de Acceso

El estándar evaluó dos enfoques para los algoritmos MAC, los protocolos de acceso distribuido y los protocolos de acceso centralizado. Los primeros distribuyen la decisión de transmisión entre todos los nodos mediante detección de portadora. Los segundos cuentan con una autoridad central que regula la transmisión.

>[!tldr] Utilización de los Enfoques
>Los protocolos de acceso distribuido son adecuados para redes ad hoc y otras configuraciones de LAN inalámbricas con tráfico intermitente. Mientras que los protocolos de acceso centralizado son ideales para redes con estaciones interconectadas a través de una estación base que sirve de enlace con una LAN troncal y son beneficiosos para datos de alta prioridad o con requisitos de tiempo real.

El resultado final definido en el estándar es el algoritmo llamado ***DFWMAC (Distributed Foundation Wireless MAC)***, que combina un control de acceso distribuido con un control centralizado opcional. La subcapa MAC inferior, la ***función de coordinación distribuida (DCF)***, utiliza un algoritmo de contención para gestionar el acceso general. Para tráfico prioritario y sin contención, se utiliza la ***función de coordinación puntual (PCF)***, que se sitúa sobre la DCF y aprovecha sus características para garantizar el acceso a sus usuarios.
La subcapa DCF utiliza CSMA para acceder al medio de comunicación. No incluye detección de colisiones porque en redes inalámbricas es difícil diferenciar entre señales débiles y ruido. Para gestionar el acceso y evitar colisiones, esta subcapa utiliza retardos basados en el ***espacio entre tramas (IFS)***, con diferentes valores para manejar prioridades:

1. **SIFS (Short IFS):** El más corto, usado para respuestas rápidas como confirmaciones y asegura la prioridad más alta en la transmisión.
2. **PIFS (Point Coordination Function IFS):** De longitud media, usado por el controlador central en PCF para emitir sondeos y tiene prioridad sobre el tráfico normal.
3. **DIFS (Distributed Coordination Function IFS):** El más largo, utilizado para tráfico ordinario y asincrónico.

La espera entre tramas permite una gestión eficiente del tráfico, donde la espera exponencial binaria maneja las cargas elevadas y los intentos repetidos de transmisión. Estas medidas ayudan a reducir colisiones y mantener la estabilidad del tráfico de red.
La subcapa PCF se implementa por sobre DCF. En este método de acceso existirá un coordinador central que gestiona la red mediante sondeos utilizando un PIFS, que es más corto que un DIFS. Esto permite al coordinador tomar control del medio rápidamente, bloqueando el tráfico asíncrono mientras realiza y recibe respuestas a los sondeos.
En un escenario extremo, el coordinador podría, teóricamente, monopolizar el medio emitiendo sondeos continuamente, especialmente en redes con estaciones que tienen tráfico sensible a los retardos. Para mitigar esto, se usa una estructura llamada *supertrama*, que divide el tiempo entre un período controlado por el coordinador y un período de contención para acceso asíncrono. Durante la primera parte de la *supertrama*, el coordinador realiza sondeos siguiendo un esquema de turno rotatorio. Después, se reserva un tiempo para que otras estaciones accedan al medio de manera competitiva.
Este enfoque permite equilibrar entre el control centralizado y el acceso competitivo, asegurando que tanto el tráfico prioritario como el tráfico regular tengan oportunidades de transmisión.

### Formato de Trama

Si bien existen tres tipos de tramas, el formato genérico de una trama MAC para las redes de área local inalámbricas tiene los siguientes campos:

- **Control de trama**: Indica el tipo de trama (control, gestión o datos) y proporciona información de control. La información de control indica si la trama proviene o va destinada a un DS, además de información adicional de control y relativa a la privacidad.
- **ID de duración/conexión**: Si se utiliza como un campo de duración, indica el tiempo (en microsegundos) que el canal será reservado para una transmisión satisfactoria de una trama MAC. En algunas tramas de control, este campo contiene el identificador de una asociación o de una conexión.
- **Direcciones**: El número y significado de los campos de direcciones dependen del contexto. Los tipos de direcciones son la de la fuente, el destino, la estación transmisora y la estación receptora.
- **Control de secuencia**: Contiene un subcampo de 4 bits utilizado para la fragmentación y el reensamblado, y un número de secuencia de 12 bits utilizado para numerar las tramas enviadas entre un transmisor dado y un receptor.
- **Cuerpo de la trama**: Contiene una MSDU completa o un fragmento de la misma. La MSDU es una unidad de datos del protocolo LLC o información de control MAC.
- ***Secuencia de comprobación de trama***: Se trata de una comprobación de redundancia cíclica de 32 bits.

#### Tipos de Trama 

Como se mencionó anteriormente para las redes de área local inalámbrica existen tres tipos de trama, las de control, las de datos y las de gestión.
Las tramas de control prestan servicio que aseguran la entrega fiable de tramas de datos. Existen seis subtipos de tramas de control:

- **Sondeo de ahorro de energía (PS-Poll, Power Save-Poll)**: Esta trama es enviada por cualquier estación hacia la estación que contiene el punto de acceso. Su objetivo es solicitar al punto de acceso que transmita una trama destinada a esta estación que ha sido almacenada en una memoria temporal debido a que la estación se encontraba en modo de ahorro de energía.
- **Solicitud para enviar (RTS)**: Esta trama se emplea para notificar tanto al destinatario potencial como a las demás estaciones dentro del alcance de que se planea enviar una trama de datos a ese destinatario específico.
- **Permiso para enviar (CTS)**: Se trata de la segunda trama en el protocolo de cuatro pasos. Es enviada por el receptor hacia el emisor para concederle permiso para emitir una trama de datos.
- **Confirmación (ACK)**: Proporciona una confirmación del destino hacia la fuente, indicando que los datos, información de gestión o sondeo de ahorro de energía previos han sido recibidos correctamente.
- **Fin de periodo libre de contención**: Anuncia el final de un periodo libre de contenciones que forma parte de la función de coordinación puntual.
- **CF-End + CF-Ack**: Confirmación de la trama CF-End. Esta trama finaliza el periodo libre de contención y libera a las estaciones de las restricciones asociadas con este periodo.

Por parte de la trama de datos, existen ocho subtipos de tramas que pueden ser organizados en dos grupos. Los primeros cuatro subtipos definen tramas que transportan datos de una capa superior desde el emisor hasta el receptor, estas tramas son las siguientes:

- **Datos**: Se trata de la trama de datos más simple. Puede ser utilizada tanto en el periodo de contención como en el periodo libre de contención.
- **Datos + CF-Ack**: Únicamente puede ser enviada durante el periodo libre de contención. Además de transportar datos, esta trama confirma la recepción de otros previamente recibidos.
- **Datos + CF-Poll**: Se utiliza por parte de un coordinador puntual para entregar datos a una estación móvil y para solicitar que ésta envíe una trama de datos que puede haber sido almacenada temporalmente.
- **Datos + CF-Ack + CF-Poll**: Combina en una sola trama las funciones de las dos tramas explicadas anteriormente.

>[!note] Aclaración sobre las Tramas Restantes
>Los cuatro subtipos restantes de tramas de datos no transportan, datos del usuario. La trama conocida como ***función nula*** no transporta datos, sondeos o confirmaciones, sino que se utiliza para transportar el bit de gestión de energía en el campo de control de una trama destinada al punto de acceso, indicando así que la estación va a entrar en un estado de operación de baja energía.
>Las tres tramas restantes poseen la misma funcionalidad que los subtipos de tramas de datos correspondientes que se han comentado en la lista anterior, pero sin transportar datos.

Por último la ***trama de gestión*** se utilizan para gestionar las comunicaciones entre las estaciones y los puntos de acceso. Las funciones que cubren incluyen la gestión de las asociaciones, es decir, la solicitud, respuesta, resolución, disociación y autenticación.

## Redes de Área Local Virtuales (VLAN)

En la actualidad muchas redes LAN institucionales modernas suelen estar configuradas de forma jerárquica, teniendo cada departamento o grupo de trabajo su propia red LAN conmutada conectada a su vez a otra red conmutada de nivel superior que les brinda acceso al resto de terminales de la red local. Aunque una configuración de este tipo funciona bien en un mundo ideal, este tipo de redes presentan una serie de desventajas:

- **Falta de aislamiento del tráfico**. Aunque la jerarquía localiza el tráfico del grupo dentro de un mismo conmutador, el tráfico de difusión tienen que atravesar toda la red institucional. Limitar el ámbito del tráfico de difusión mejoraría el rendimiento de la LAN. Quizá más importante, sería también deseable limitar el tráfico de difusión de la LAN por razones de seguridad y confidencialidad.
- **Uso ineficiente de los conmutadores**. Si una institución tiene 10 grupos, entonces se necesitarían 10 conmutadores de primer nivel. Si cada uno de los grupos es pequeño, entonces un único conmutador con los puertos suficientes para acomodar a todo el mundo, pero este único conmutador no proporcionaría la funcionalidad de aislamiento del tráfico.
- **Gestión de los usuarios**. Si un empleado se mueve entre grupos, el cableado físico debe modificarse para conectar al empleado a un conmutador diferente, esto se torna más complejo si los empleados pertenecen dos o más grupos.

Afortunadamente, cada una de estas desventajas puede ser abordada mediante el uso de conmutadores compatibles con _**redes de área local virtuales (VLAN)**_. Estos conmutadores permiten definir múltiples VLAN sobre una única infraestructura física de red de área local.
En una VLAN basada en puertos, el administrador de la red divide las interfaces del conmutador en grupos. Cada grupo constituye una VLAN, donde los puertos de cada VLAN forman un dominio de difusión. Con esta configuración, solo los dispositivos pertenecientes al mismo grupo recibirán los mensajes de difusión, aislando así el tráfico interno de la organización.
Debido a este aislamiento, es imposible intercambiar tráfico entre los distintos grupos de la red. Este inconveniente se resuelve conectando una de las interfaces de cada grupo a un router, que se encargará de redirigir el tráfico entre VLAN. Afortunadamente, muchos conmutadores modernos ya incluyen un router integrado que gestiona el redireccionamiento entre VLAN.
Un aspecto interesante de las VLAN es que permiten que dispositivos ubicados en diferentes edificios pertenezcan a la misma red virtual. Esto se logra interconectando los distintos conmutadores VLAN mediante la técnica conocida como _**troncalización VLAN (VLAN Trunking)**_. Esta técnica configura una interfaz como troncal, la cual conecta ambos conmutadores VLAN. El puerto troncal pertenece a todas las VLAN, y las tramas enviadas a cualquier VLAN son reenviadas a través del enlace troncal hacia el otro conmutador.
Un desafío que surge en este escenario es identificar a qué VLAN pertenece una trama cuando se envía a través del enlace troncal. Para solucionar esto, el estándar IEEE define un formato de trama Ethernet extendido, que incluye la trama Ethernet estándar más una _**etiqueta VLAN**_ de 4 bytes añadida a la cabecera de la trama. 

![[trama-con-tpid.png]]

Esta etiqueta identifica la VLAN a la que está destinada la trama. Al enviar una trama a través del enlace troncal, el conmutador emisor agrega la etiqueta VLAN a la trama, y al llegar a destino, la etiqueta es analizada y eliminada por el conmutador receptor.

>[!tldr] Tag Protocol Identifier (TPID)
>La etiqueta VLAN se compone de los siguientes campos:
>
>- **Identificador de Protocolo de Etiquetado (TPID)**: Campo de 2 bytes, con un valor hexadecimal fijo de 81-00.
>- **Control de Etiquetado (Tag Control Information)**: Campo de 2 bytes, el cual incluye un campo identificador de VLAN de 12 bits y un campo de prioridad de 3 bits, cuya función es similar a la del campo TOS en los datagramas IP.

