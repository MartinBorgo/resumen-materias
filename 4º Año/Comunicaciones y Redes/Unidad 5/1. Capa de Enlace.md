La capa de enlace de datos utiliza los servicios de la capa física para enviar y recibir bits a través de los canales de comunicación. Tiene varias funciones específicas, entre las que se incluyen:

1. Proporcionar a la capa de red una interfaz de servicio bien definida.
2. Manejar los errores de transmisión.
3. Regular el flujo de datos para que los emisores rápidos no saturen a los receptores lentos.

Para cumplir con estas metas, la capa de enlace de datos toma los paquetes que obtiene de la capa de red y los encapsula en ***tramas*** para transmitirlos. Cada trama contiene un encabezado, un campo de carga útil para almacenar el paquete y un terminador.
El protocolo de la capa de enlace define el formato de los paquetes intercambiados por los nodos situados en los extremos del enlace, así como las acciones que estos nodos llevan a cabo cuando se envían y reciben los paquetes.
El servicio básico de cualquier capa de enlace es mover un datagrama desde un nodo hasta otro adyacente a través de un único enlace de comunicaciones, aunque los detalles del servicio proporcionado pueden variar de un protocolo de la capa de enlace a otro. Entre los posibles servicios que un protocolo de la capa de enlace puede ofrecer se incluyen:

- **Entramado**. Casi todos los protocolos de la capa de enlace encapsulan cada datagrama de la capa de red dentro de una trama de la capa de enlace antes de transmitirla a través del enlace. La estructura de la trama está especificada por el protocolo de la capa de enlace.
- **Acceso al enlace**. Un ***protocolo de control de acceso al medio (MAC)*** especifica las reglas que se utilizan para transmitir una trama a través del enlace. Además este protocolo también se encarga de coordinar la transmisión de tramas cuando existe un único enlace de difusión el cual es compartido por múltiples nodos.
- **Entrega fiable**. Cuando un protocolo de la capa de enlace proporciona un servicio de entrega fiable, garantiza que va a transportar cada datagrama de la capa de red a través del enlace sin que se produzcan errores. A menudo se utiliza un servicio de entrega fiable de la capa de enlace en aquellos enlaces que suelen presentar altas tasas de error, como por ejemplo en los enlaces inalámbricos.
- **Control de flujo**. De forma similar a lo que sucede en la capa de transporte, el protocolo de la capa de enlace puede proporcionar un mecanismo de control de flujo para evitar que el nodo emisor sobrecargue los buffers del nodo receptor.
- **Detección de errores**. El ruido electromagnético y la atenuación de las señales pueden llegar a producir cambios en los bits que se envían a través de un enlace, por esta razón es necesario implementar un mecanismo de detección de errores evitando así reenviar esa trama corrupta a otro nodo. Generalmente el mecanismo utilizado para la comprobación de error es a través de la suma de comprobación.
- **Corrección de errores**. La corrección de errores es similar a la detección de errores, con la diferencia que en este caso el receptor no sólo detecta si hay bits erróneos en la trama, sino que también determina exactamente en qué puntos de la trama se han producido los errores para luego corregir esos errores.

Muchos de los servicios proporcionados por la capa de enlace presentan notables paralelismos con los servicios proporcionados en la capa de transporte, no obstante no son lo mismo, ya que están construidos con fines diferentes.

>[!tldr] Implementación de la Capa de Enlace
>En su mayor parte, la capa de enlace se implementa en un adaptador de red, también denominado a veces tarjeta de interfaz de redo simplemente placa de red. El corazón de la tarjeta adaptador de red es el controlador de la capa de enlace, que normalmente es un único chip de propósito especial que implementa muchos de los servicios de la capa de enlace.
>
>![[implementacion-enlace.png]]

## Delimitación de las Tramas

Para proveer servicio a la capa de red, la capa de enlace de datos debe usar el servicio que la capa física le proporciona, lo que hace la capa física es aceptar un flujo de bits puros y tratar de entregarlo al destino. Por esta razón la tarea de dividir el flujo de bits en tramas no resulta una tarea sencilla. Un buen diseño debe
facilitar a un receptor el proceso de encontrar el inicio de las nuevas tramas al tiempo que utiliza una pequeña parte del ancho de banda del canal, para realizar esta tarea existen 4 métodos.

1. **Conteo de bytes**: Utiliza un campo en la cabecera de la trama para indicar el largo en bytes de esta. Cuando la capa de enlace de datos del destino ve el conteo de bytes, sabe dónde concluye la trama. Este método tiene el percance de que este contador puede ser alterado por algún error de transmisión.
2. **Bytes bandera con relleno de bytes**: Se utiliza un byte bandera para indicar el inicio y final de cada trama, con este método dos bytes bandera consecutivos señalan el final de una trama y el inicio de la siguiente. Con el inconveniente de que este byte bandera puede aparecer dentro del contenido de la trama haciendo que se desincronizen todo el envío de datos, una forma de resolver eso es utilizar un byte de escape antes del byte bandera, con la desventaja de que esto produce *overhead* en la trama.
3. **Bits bandera con relleno de bits**: Es muy similar al método anterior con la diferencia que se utiliza una cantidad de bits arbitraria como delimitador. Para evitar que dicho patrón de bits que actúan como delimitador se confunda con los contenidos de la carga útil el receptor al encontrar un patrón similar en el contenido de la trama reemplaza automáticamente el siguiente bit por uno de escape. Es el receptor el que reemplaza esos bits de escape por sus valores originales.
4. **Violaciones de codificación de la capa física**: Utiliza un rango de señales determinada a nivel de hardware para indicar el comienzo y final de la trama. Este método resulta muy práctico ya que como ya existen ciertas señales reservadas se puede encontrar el inicio y final de la trama de forma sencilla sin necesidad de rellenar los datos.

Muchos protocolos de esta capa usan una combinación de estos métodos por seguridad. Por ejemplo un patrón común utilizado para Ethernet y 802.11 es hacer que una trama inicie con un patrón bien definido, conocido como ***preámbulo***, dicho patrón podría ser bastante largo de modo que el receptor se pueda preparar para un paquete entrante. El preámbulo va seguido de un campo de longitud en el encabezado, que se utiliza para localizar el final de la trama.

## Tipos de Servicios de Transmisión

La capa de enlace de datos puede diseñarse para ofrecer varios servicios. Los servicios reales ofrecidos varían de un protocolo a otro. Tres posibilidades razonables que normalmente se proporcionan son:

1. **Servicio sin conexión ni confirmación de recepción**: La máquina de origen envíe tramas independientes a la máquina de destino sin que ésta confirme la recepción, por lo que no se establece una conexión lógica de antemano. Si se pierde una trama debido a ruido en la línea, en la capa de datos no se realiza ningún intento por detectar la pérdida o recuperarse de ella. Esta clase de servicio es apropiada cuando la tasa de error es muy baja, de modo que la recuperación se deja a las capas superiores.
2. **Servicio sin conexión con confirmación de recepción**: La máquina de origen envía tramas sin establecer una conexión lógica entre los nodos, pero el receptor confirma de manera individual la recepción de cada trama enviada. De esta manera, el emisor sabe si la trama llegó bien o se perdió. Si no ha llegado en un intervalo especificado, se puede enviar de nuevo. Este servicio es útil en canales no confiables, como los de los sistemas inalámbricos.
3. **Servicio orientado a conexión con confirmación de recepción**: Las máquinas de origen y de destino establecen una conexión antes de transferir datos. Cada trama enviada a través de la conexión está numerada, y la capa de enlace de datos garantiza que cada trama enviada llegará a su destino. Garantizando además que cada trama se recibirá exactamente una vez y que todas las tramas se recibirán en el orden correcto.

## Técnicas de Detección y Corrección de Errores

Las técnicas de detección y corrección de errores permiten al receptor detectar en ocasiones, pero no siempre, que se han producido errores en los bits. Incluso utilizando bits de detección de errores pueden seguir existiendo errores de bit no detectados. Por tanto, lo que intentaremos será elegir un esquema de detección de errores que haga que la probabilidad de que se produzcan estos casos sea pequeña. Por regla general, cuanto más sofisticadas son las técnicas de detección y corrección de errores mayores son los recursos adicionales necesarios

### Comprobación de Paridad

Quizá la forma más simple de detección de errores sea el uso de un único **bit de paridad**, este bit de paridad no es más que un bit adicional que el emisor pone al final de la carga útil de la trama y dependiendo del tipo de paridad elegida la cantidad de unos de la carga útil mas este bit sera par o impar.
La operación del receptor también es muy simple, cuando se utiliza un único bit de paridad el receptor sólo necesita contar el número de unos dentro de los $d + 1$ bits recibidos. Si se está utilizando un esquema de paridad par y se encuentra un número impar de bits con valor 1, el receptor sabrá que se ha producido al menos un error de bit.
Este método es fácil de implementar y usar, pero no detecta errores de dos bits, ya que el contador de paridad daría 1, indicando que no hay error. Aunque la probabilidad de estos errores parece baja, las mediciones muestran que los errores suelen agruparse en “ráfagas”. En estas condiciones, la probabilidad de errores no detectados en una trama con un solo bit de paridad puede llegar al 50%.

>[!tldr] Corrección de Errores hacia Adelante
>La capacidad del receptor para detectar y corregir errores a la vez se conoce con el nombre de ***corrección de errores hacia adelante (FEC)***. Estas técnicas se suelen utilizar comúnmente en los dispositivos de almacenamiento y reproducción de audio, como por ejemplo los CD de audio. En un entorno de red, las técnicas FEC también pueden emplearse por sí mismas o en conjunción con técnicas ARQ.

### Suma de Comprobación

En las técnicas de suma de comprobación, los $d$ bits de datos se tratan como una secuencia de enteros de $k$ bits. Un método simple de suma de comprobación consiste en sumar estos enteros de $k$ bits y utilizar la suma resultante como bits de detección de errores. Un ejemplo de este método es la ***suma de comprobación de Internet***, el cual es utilizado por protocolos como TCP y UDP, con la diferencia que para calcular esta suma se utilizan otros cálculos adicionales. Cabe aclarar que esta suma de comprobación se puede realizar solo sobre la carga útil, sobre la carga útil y el encabezado o protocolos como XTP calculan dos sumas de comprobación, una para la cabecera y otro para la carga útil.
Los métodos de suma de comprobación requieren relativamente poca sobrecarga de paquete. Sin embargo, estas sumas proporcionan una protección relativamente débil frente a los errores si las comparamos con las comprobaciones de redundancia cíclica.

## Comprobación de Redundancia Cíclica

Una técnica detección de errores utilizada ampliamente en las redes de computadoras de hoy día esta basada en los ***códigos de comprobación de redundancia cíclica (CRC)***.
Los códigos CRC operan de la siguiente manera. Considere una secuencia de datos $D$ con una longitud de $d$ bits, que el nodo emisor quiere transmitir al nodo receptor. El emisor y el receptor tienen que acordar primero un patrón $G$ de $r + 1$ bits, conocido como **generador**. Para un determinada secuencia de datos $D$, el emisor seleccionará $r$ bits adicionales a los que llamaremos $R$, y se los añadirá a $D$, de modo que el patrón de $d + r$ bits resultante sea exactamente divisible por $G$ utilizando aritmética módulo 2. Para realizar el proceso de comprobación de errores, el receptor divide los $d + r$ bits recibidos entre $G$. Si el resto es distinto de cero, el receptor sabrá que se ha producido error; en caso contrario, se aceptarán los datos como correctos.
Cada uno de los estándares de CRC puede detectar ráfagas de errores inferiores a $r + 1$ bits. Además, en las condiciones adecuadas, una ráfaga de longitud superior a $r + 1$ bits será detectada con una probabilidad de $1 – \ 0.5^r$.