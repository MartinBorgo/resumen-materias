El propósito de los distintos algoritmos de ruteo o encaminamiento es encontrar el camino hacia el host de origen, estos algoritmos se pueden encasillar en dos grandes grupos:

- **Algoritmos de enrutamiento globales**: calcula la ruta de coste mínimo entre un origen y un destino utilizando el conocimiento global y completo acerca de la red. Es decir, el algoritmo toma como entradas la conectividad entre todos los nodos y todos los costes de enlace. En la práctica, los algoritmos con información de estado global a menudo se denominan ***algoritmos de estado de enlaces*** (Link-State).
- **Algoritmos de enrutamiento descentralizados**: el cálculo de la ruta de coste mínimo se realiza de manera iterativa y distribuida. Ningún nodo tiene toda la información acerca del coste de todos los enlaces de la red, en su lugar cada nodo sólo conoce los costes de sus enlaces hacia los nodos cercanos a el. Dentro de esta categoría se encasillan los ***algoritmos de vector de distancia*** (Distance-Vector).

### Algoritmo de Enrutamiento de Estado de Enlaces

Para poder ejecutar este algoritmo primero se necesita tener conocimiento del estado de todos los routers de la red, esto se consigue haciendo que cada nodo difunda paquetes del estado de los enlaces a todos los demás nodos de la red, con cada paquete de estado de enlace conteniendo las identidades y los costes de sus enlaces conectados. 
Cada enrutador recibe múltiples paquetes de estado de enlaces de diferentes enrutadores y los utiliza para construir y mantener una base de datos de estado de enlaces. Esta base de datos es una representación completa de la topología de la red desde la perspectiva del enrutador. Con la base de datos completa, cada enrutador aplica el algoritmo de Dijkstra para calcular el caminos mínimos. El resultado de este cálculo es una tabla de enrutamiento que dirige los paquetes a su destino final a través de la ruta más eficiente.
Los enrutadores periódicamente repiten este proceso, enviando nuevos paquetes de estado de enlaces para informar a otros sobre cambios en la topología, como enlaces caídos o recuperados. Esto asegura que la base de datos de estado de enlaces esté siempre actualizada y que las rutas sean recalculadas para adaptarse a los cambios en la red.

### Algoritmo de Enrutamiento por Vector de Distancia

Al contrario que en el algoritmo de estado de enlaces, cada enrutador en la red inicia con una tabla de enrutamiento que contiene las distancias a todos los destinos directamente conectados. Los destinos no directamente accesibles se marcan con una distancia infinita.
Los enrutador comparte su tabla de enrutamiento con sus vecinos directos en intervalos regulares de tiempo o cuando se detectan cambios en la red. Estos intercambios se realizan utilizando mensajes que contienen el vector de distancias, es decir, la lista de todas las rutas conocidas y sus distancias.
Cuando un enrutador recibe una tabla de enrutamiento de un vecino, compara esta información con su propia tabla. Para cada destino, el enrutador verifica si existe una ruta más corta a través del vecino que la ruta actualmente conocida. Esto se hace sumando la distancia al vecino más la distancia del vecino al destino final. Si esta ruta indirecta es más corta, el enrutador actualiza su tabla de enrutamiento para reflejar esta nueva ruta más corta.
El proceso de actualización permite a cada enrutador determinar la distancia más corta a cada destino utilizando el principio de "menor costo". El costo puede basarse en varios factores como número de saltos, velocidad del enlace, latencia, etc.

>[!tldr] Desventajas del Algoritmo de Encaminamiento por Vector de Distancia
>Una de las desventajas del enrutamiento por vector de distancias es el problema de los bucles de enrutamiento y el problema de "contar hasta el infinito". Los bucles de enrutamiento pueden ocurrir cuando dos o más enrutadores se informan mutuamente sobre una ruta a un destino que ya no es accesible, lo que lleva a la creación de un bucle.
>Para mitigar estos problemas, se han desarrollado técnicas como el horizonte dividido, que impide que un enrutador envíe información sobre una ruta de regreso por el camino por el que la aprendió, y el envenenamiento de ruta, que utiliza la propagación de una distancia "infinita" para un destino fallido para prevenir bucles.
## Sistemas Autónomos

Si bien estos dos algoritmos resultan útiles a la hora de realizar el direccionamiento de los paquetes, a medido que se van agregando más routers a la red los calculo para realizar dicho encaminamiento se dificulta debido al tamaño de la red o porque diferentes routers utilizan algoritmos de encaminamientos distintos, además surgen problemas de índole administrativas ya que puede que la empresa desee ocultar cierta información de su red interna.
Estos dos problemas pueden ser solucionados organizando a los distintos routers como sistemas autónomos, donde cada sistema autónomo está formado por grupo de routers que normalmente se encuentran bajo el mismo control administrativo. Los routers pertenecientes a los mismos sistemas utilizan el mismo algoritmo de encaminamiento y disponen de información acerca de ellos. El algoritmo de enrutamiento que se ejecuta dentro de un sistema autónomo se conoce como ***protocolo de enrutamiento interno del sistema autónomo***. Para conectar los distintos sistemas autónomos pueden existir uno o más routers que se encarguen de reenviar el paquete hacia el exterior del sistema, estos routers se conocen con el nombre de ***routers gateway***.
Cuando un sistema autónomo esta conectado a dos o más sistemas autónomos externos, el sistema va a tener que poseer una manera de realizar el direccionamiento de los paquetes hacia el gateway indicado, para resolver este problema se deben realizar dos actividades:

1. El sistema autónomo tiene que aprender que destinos son alcanzables desde cada una de las gateways.
2. Propagar esa información de alcanzabilidad a todos los routers del sistema, de manera que cada router pueda configurar su tabla de reenvío para gestionar los destinos externos al sistema autónomo.

De estas dos tareas se encarga el ***protocolo de enrutamiento entre sistemas autónomos***. De hecho, en Internet, todos los sistemas autónomos ejecutan el mismo protocolo de enrutamiento interno, el protocolo BGP4. Cuando un sistema autónomo obtiene información acerca de un destino de un sistema autónomo vecino, puede anunciar esta información de enrutamiento a algunos de sus otros sistemas autónomos vecinos.

### Enrutamiento Interno de un Sistema Autónomo

Un protocolo de enrutamiento interno de un sistema autónomo se utiliza para determinar cómo se lleva acabo el enrutamiento dentro de un sistema autónomo. Los protocolos de enrutamiento internos de los sistema autónomo se conocen también como ***protocolos de pasarela interior***. El enrutamiento dentro de los sistemas autónomos de Internet se ha llevado a cabo principalmente con dos protocolos de enrutamiento
#### Routing Information Protocol (RIP)

Es un protocolo de vector de distancias que opera de una forma muy parecida a este, en su especificación se utiliza la métrica de recuentos de saltos para evaluar el costo entre un enlace y otro. En este protocolo el coste máximo de una ruta está limitada a 15 saltos, y los intercambios de información entre los routers que forman parte del sistema se realizan cada 30 segundos mediante un ***mensaje de respuesta RIP***, los routers se envían entre sí solicitudes y mensajes de respuesta RIP utilizando UDP a través del puerto 520, ya que este protocolo fue desarrollado como una aplicación. Un router también puede solicitar información a sus vecinos, mediante un mensajes de solicitud RIP, acerca del coste a un destino dado. Si pasa un periodo de 180 segundos sin recibir respuestas por parte de uno de los vecinos, el nodo considerará que ese vecino ya no es alcanzable.
#### Open Shortest Path First (OSPF)

Es un protocolo de estado de enlaces que utiliza la técnica de inundación de información de estado de los enlaces y el algoritmo de cálculo de la ruta de coste mínimo de Dijkstra. OSPF no establece una política para definir el peso de los enlaces, sino que proporciona mecanismos para determinar el enrutamiento de coste mínimo para el conjunto dado de pesos de los enlaces, es decir, el administrador de la red configura los costes de los enlaces individuales y el protocolo en base a eso se encarga de calcular el camino más corto.
Al contrario que RIP, este protocolo esta implementado a nivel de red, esto quiere decir que tiene que implementar por sí mismo funcionalidades tales como la de transferencia fiable de mensajes y la de envío de mensajes de difusión acerca del estado de los enlaces, ya que no utiliza ninguno de los servicios de la capa de transporte. Además OSPF también comprueba que los enlaces estén operativos.
Un sistema autónomo OSPF puede configurarse jerárquicamente en áreas. Cada área ejecuta su propio algoritmo de enrutamiento de estado de enlaces OSPF. Dentro de cada área, uno o más routers de frontera de área son responsables de enrutar los paquetes fuera del área. Para resolver la correspondencia entre áreas se configura un único área OSPF del sistema autónomo para actuar como área ***troncal***, cuya principal función es enrutar el tráfico entre las demás áreas del sistema autónomo.

>[!tldr] Tiempo de Vida y Suma de Comprobación de los Paquetes IP
>Cada vez que un paquete llega a un router, este realiza dos actividades básicas.
>1. Resta en una unidad el tiempo de vida de ese paquete, y en caso de que este sea 0 el router descarta el paquete correspondiente y envía un mensaje informando al emisor que su paquete a sido descartado por la red.
>2. Cada vez que los paquetes llegan a un router, el router recalcula la suma de comprobación o ***checksum*** de la cabecera IP, ya que es probable que el router haya modificado las cabeceras del paquete. Si el checksum no concuerda después de la recalculación, indica que los datos han sido corruptos durante la transmisión.

## Direccionamiento en la Capa de Enlace

Todos lo nodos de la red que cuenten con un adaptador o placa de red, cuentan con una dirección de capa de enlace, que es utilizada para realizar redireccionamientos de tramas en redes de área local (LAN). A este tipo de direcciones se las conoce como direcciones LAN, direcciones físicas o direcciones MAC, estas poseen una longitud de 48 bits, y suelen mostrarse utilizando una notación hexadecimal. La principal particularidad de este tipo de direcciones es que son únicas para cada adaptador de red que exista en el mundo. La IEEE se encarga de gestionar y asignar los espacios de direcciones MAC, cuando una empresa quiere comenzar a fabricar adaptadores, compra a la IEEE una parte fija del campo de direcciones, la IEEE le asigna a la empresa los primeros 24 bits y deja los últimos 24 bits para que el fabricante pueda producir un determinado número de adaptadores. En sus inicios las direcciones MAC fueron diseñadas para ser permanentes, aunque hoy en día con el software apropiado estas direcciones pueden ser modificadas.
Cuando un adaptador de red quiere enviar una trama a otro adaptador, inserta la dirección MAC en la trama y luego al envía a través de la red LAN, esta trama es recibida y procesada por todos los adaptadores de la red LAN. Cada adaptador realizara una comprobación para ver si la dirección MAC de destino coincide con la suya propia, si estas coinciden el adaptador extrae el paquete de la trama y lo envía a las capas superiores del protocolo, para entregárselo a su nodo padre. Pero si las direcciones no coinciden el adaptador de red descarta la trama, sin pasar el paquete hacia las capas superiores.

>[!note] Mensajes de Difusión de la Capa de Enlace
>Al igual que en la capa de red, los adaptadores de red pueden enviar una trama a todos los demás adaptadores de la red LAN utilizando la dirección de difusión FF-FF-FF-FF-FF-FF.

### Address Resolution Protocol (ARP)

Dado que existen tanto direcciones de la capa de red como direcciones de la capa de enlace, surge la necesidad de una traducción entre ellas. El protocolo de resolución de direcciones es el encargado de realizar estas traducciones. A grandes rasgos todos los adaptadores de red tendrán un módulo ARP que recibirá una dirección IP y devolverá la dirección MAC correspondiente a ese equipo.
La forma en la que funciona realmente ARP es muy similar a DNS, ya que se encarga de resolver correspondencias entre direcciones IP y MAC, con la diferencia de que ARP resuelve las correspondencias de direcciones IP de nodos que perteneces a una misma subred. Cada nodo en la subred tiene en su memoria una ***tabla ARP***, que contiene las correspondencias entre direcciones IP y MAC, al igual que el tiempo de vida de este registro en la tabla. No todos los nodos de la subred cuentan con una entrada para corresponder a cada dispositivo de la subred, puede que solo contenga algunas correspondencias o directamente ni una. En caso de no se pueda resolver la correspondencia a través de la tabla ARP, el nodo emisor construye un paquete especial denominado ***paquete ARP***, estos paquetes contiene varios campos, en los cuales se incluyen las direcciones MAC del emisor y la IP del receptor, este paquete se pasa al adaptador de red indicandole que el paquete será enviado a través de un broadcast MAC. El adaptador encapsula el paquete en una trama y lo envía a todos los nodos de la subred, por su parte los demás nodos reciben la trama la desempaquetan y pasa el paquete al módulo ARP donde se realiza el chequeo para ver si la dirección IP de destino se corresponde con la de ese host, en caso de que esto sea así el nodo enviará una respuesta ARP con la información correspondiente, de este modo el emisor actualizará su tabla ARP y podrá comenzar a enviar las tramas, en caso de la correspondencia no se de, el paquete es descartado.